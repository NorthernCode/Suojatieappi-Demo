<html>
<head>
	<script type="text/javascript" src="lib/jquery-1.11.3.min.js"></script>
	<title>Suojatie - Demo</title>
	<style>
		.debug {
			display: none;
		}
		#bg {
			width: 100%;
			margin: auto;
			position: fixed;
		}
		#sign {
			width: 80%;
			margin-left: auto;
			margin-right: auto;
			position: fixed;
			left: 10%;
			top: 20%;
		}
		#sign-container {
			display: none;
		}
		body {
			margin: 0; 
			padding: 0; 
		}
	</style>
</head>
<body>
	<img src="assets/bg.png" id="bg"></img>
	<div id="sign-container"><img src="assets/roadsign.png" id="sign"></img></div>
	<div id="gps" class="debug"></div>
	<div id="data" class="debug"></div>
	<div id="sandbox" style="border:solid;" class="debug"></div>
	<script src="phonegap.js"></script>
	<script type="text/javascript">
		var gpsEvents = [];
		var gps;
		var zebraData;
		function getGPS(){
			if(navigator.geolocation){
				var options = {timeout:60000, enableHighAccuracy:true};
                navigator.geolocation.watchPosition(showPos, errorHandler, options);
			}else{
				alert("no gps");
			}
		}
		function showPos(location){
			gps = location;
			$("#gps").text("Location:" + location.coords.latitude.toFixed(2) + "," +location.coords.longitude.toFixed(2));
			checkTiles(gps);
		}

		function errorHandler(err) {
            if(err.code == 1) {
               alert("Error: Access is denied!");
            }
            
            else if( err.code == 2) {
               alert("Error: Position is unavailable!");
            }
        }

        function showData(data){
        	zebraData = data;
         	$( "#data" ).text( JSON.stringify(data, null, 2) );
        }

        function getData(){
        	var gpsString = "" + gps.coords.latitude.toFixed(2) + "," + gps.coords.longitude.toFixed(2) + "," + (gps.coords.latitude + 0.01).toFixed(2) + "," + (gps.coords.longitude + 0.01).toFixed(2)
			$.ajax({
			     url:"http://overpass-api.de/api/interpreter?data=[out:json];node%20[%22highway%22=%22crossing%22]("+ gpsString + ");%20out%3B",
			     dataType: 'json',
			     success:function(json){
			         	showData(json);
			        },
			     error:function(){
			         alert("Error");
			     }      
			});
        }
        
	getGPS();

	function remote(view){
		if (view == "1") { $('#sign-container' ).css( "display", "block" ); }
		else { $( '#sign-container' ).css( "display", "none" ); }
	}

	function checkRemote(){
		$.ajax({
		     url:"http://169.254.76.226:90/remoteapi/status.php",
		     success:function(data){
		         	remote(data);
		        },
		     error:function(){
		         alert("Error");
		     }      
		});
    }

    window.setInterval(checkRemote, 3000);
	</script>
	<script type="text/javascript" src="script.js"></script>
</body>
</html>
