<html>
<head>
	<script type="text/javascript" src="lib/jquery-1.11.3.min.js"></script>
	<title>Suojatie - Demo</title>
</head>
<body>
        <div>Turvassa yli!</div>
	<div id="gps"></div>
	<div id="data"></div>
	<div id="sandbox" style="border:solid;"></div>
	<script type="text/javascript">
		var gpsEvents = [];
		var gps;
		function getGPS(){
			if(navigator.geolocation){
				var options = {timeout:60000, enableHighAccuracy:true};
                navigator.geolocation.watchPosition(showPos, errorHandler, options);
			}else{
				alert("no gps");
			}
		}
		function showPos(location){
			gps = location;
			$("#gps").text("Location:" + location.coords.latitude.toFixed(2) + "," +location.coords.longitude.toFixed(2));
			getData();
		}

		function errorHandler(err) {
            if(err.code == 1) {
               alert("Error: Access is denied!");
            }
            
            else if( err.code == 2) {
               alert("Error: Position is unavailable!");
            }
        }

        function showData(data){
         	$( "#data" ).text( JSON.stringify(data, null, 2) );
        }

        function getData(){
        	var gpsString = "" + gps.coords.latitude.toFixed(2) + "," + gps.coords.longitude.toFixed(2) + "," + (gps.coords.latitude + 0.01).toFixed(2) + "," + (gps.coords.longitude + 0.01).toFixed(2)
			$.ajax({
			     url:"http://overpass-api.de/api/interpreter?data=[out:json];node%20[%22highway%22=%22crossing%22]("+ gpsString + ");%20out%3B",
			     dataType: 'json',
			     success:function(json){
			         	showData(json);
			        },
			     error:function(){
			         alert("Error");
			     }      
			});
        }
        
	getGPS();
	</script>
	<script type="text/javascript" src="script.js"></script>
</body>
</html>
